
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>TP 04.2B: Suppression de donn√©es d&#39;une base de donn√©es Room</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/claat-public/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-3295395-7" ga4id="G-E0H6JSF2N3"></google-codelab-analytics>
  <google-codelab codelab-gaid="UA-3295395-7"
                  codelab-ga4id="G-E0H6JSF2N3"
                  id="deleting-data-room-database"
                  title="TP 04.2B: Suppression de donn√©es d&#39;une base de donn√©es Room"
                  environment="web"
                  feedback-link="https://github.com/khammami/codelabs-enetcom/issues">
    
      <google-codelab-step label="Bienvenue" duration="0">
        <p>Ces travaux pratiques se base sur le cours de base pour les d√©veloppeurs Android fourni par Google afin de  les pr√©parer pour le test de certification <a href="https://developers.google.com/training/certification/associate-android-developer/" target="_blank">Associate Android Developer</a>. Vous obtiendrez le plus de valeur de ce TP si vous travaillez successivement dans les codelabs.</p>
<h2 is-upgraded>Introduction</h2>
<p>Ce codelab pratique fait suite au <strong><code>4.2A : Room, LiveData et ViewModel</code></strong>. Ce codelab vous permet de vous entra√Æner davantage √† utiliser l&#39;API fournie par la biblioth√®que Room pour impl√©menter des fonctionnalit√©s de base de donn√©es. Vous ajouterez la possibilit√© de supprimer des √©l√©ments sp√©cifiques de la base de donn√©es. Ce codelab comprend √©galement un d√©fi de codage, dans lequel vous mettez √† jour l&#39;application pour que l&#39;utilisateur puisse modifier les donn√©es existantes.</p>
<h2 is-upgraded>What you should already know</h2>
<p>Vous devriez √™tre capable de cr√©er et d&#39;ex√©cuter des applications dans <a href="https://developer.android.com/studio/index.html" target="_blank">Android Studio Ladybug (2024.2.1) ou une version sup√©rieure</a>. En particulier, vous devez √™tre familiaris√© avec les √©l√©ments suivants :</p>
<ul>
<li>Utilisation de <code>RecyclerView</code> et des adaptateurs</li>
<li>Utilisation de classes d&#39;entit√©s, d&#39;objets d&#39;acc√®s aux donn√©es (DAO) et de <code>RoomDatabase</code> pour stocker et r√©cup√©rer des donn√©es dans la base de donn√©es SQLite int√©gr√©e d&#39;Android. Vous avez appris ces sujets dans <code>4.2A : Room, LiveData et ViewModel</code>.</li>
</ul>
<h2 class="checklist" is-upgraded>What you&#39;ll learn</h2>
<ul class="checklist">
<li>Comment peupler la base de donn√©es avec des donn√©es uniquement si la base de donn√©es est vide (afin que les utilisateurs ne perdent pas les modifications qu&#39;ils ont apport√©es aux donn√©es).</li>
<li>Comment supprimer des donn√©es d&#39;une base de donn√©es Room.</li>
<li>Comment mettre √† jour des donn√©es existantes (si vous construisez l&#39;application de d√©fi).</li>
</ul>
<h2 is-upgraded>What you&#39;ll do</h2>
<ul>
<li>Mise √† jour de l&#39;application <code>RoomWordsSample</code> pour conserver les donn√©es lorsque l&#39;application se ferme.</li>
<li>Permettre aux utilisateurs de supprimer tous les mots en s√©lectionnant un √©l√©ment du menu d&#39;options.</li>
<li>Permettre aux utilisateurs de supprimer un mot sp√©cifique en balayant un √©l√©ment de la liste.</li>
<li>En option, dans un d√©fi de codage, √©tendre l&#39;application pour permettre √† l&#39;utilisateur de mettre √† jour les mots existants.</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Aper√ßu de l&#39;application" duration="0">
        <p>Vous allez √©tendre l&#39;application RoomWordsSample que vous avez cr√©√©e dans le codelab pr√©c√©dent. Jusqu&#39;√† pr√©sent, cette application affiche une liste de mots et les utilisateurs peuvent ajouter des mots. Lorsque l&#39;application est ferm√©e et rouverte, elle r√©initialise la base de donn√©es. Les mots que l&#39;utilisateur a ajout√©s sont perdus.</p>
<p>Dans ce TP, vous √©tendez l&#39;application afin qu&#39;elle initialise les donn√©es de la base de donn√©es uniquement s&#39;il n&#39;y a pas de donn√©es existantes.</p>
<p>Ensuite, vous ajoutez un √©l√©ment de menu qui permet √† l&#39;utilisateur de supprimer toutes les donn√©es.</p>
<p class="image-container"><img style="width: 537.00px" src="img/3f73f6ff1475fc35.png"></p>
<p>Vous permettez √©galement √† l&#39;utilisateur de balayer un mot pour le supprimer de la base de donn√©es.</p>
<p class="image-container"><img style="width: 221.59px" src="img/6639edd4da022795.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Initialiser les donn√©es uniquement si la base de donn√©es est vide" duration="0">
        <p>L&#39;application <code>RoomWordsSample</code> que vous avez cr√©√©e dans le pr√©c√©dent exercice pratique supprime et recr√©e les donn√©es chaque fois que l&#39;utilisateur ouvre l&#39;application. Ce comportement n&#39;est pas id√©al, car les utilisateurs souhaitent que leurs mots ajout√©s restent dans la base de donn√©es lorsque l&#39;application est ferm√©e. (Le code de la solution de l&#39;exercice pr√©c√©dent se trouve sur GitHub.)</p>
<p>Dans cette t√¢che, vous devez mettre √† jour l&#39;application afin que, lorsqu&#39;elle s&#39;ouvre, le jeu de donn√©es initial ne soit ajout√© que si la base de donn√©es ne contient pas de donn√©es.</p>
<p>Pour d√©tecter si la base de donn√©es contient d√©j√† des donn√©es, vous pouvez ex√©cuter une requ√™te pour obtenir un √©l√©ment de donn√©es. Si la requ√™te ne renvoie rien, alors la base de donn√©es est vide.</p>
<p><a href="https://github.com/khammami/android-fundamentals-exycodelabs/archive/refs/heads/room-words-sample-2023.zip" target="_blank"><paper-button class="colored" raised>T√©l√©charger .zip</paper-button></a> <a href="https://github.com/khammami/android-fundamentals-exycodelabs/tree/room-words-sample-2023" target="_blank"><paper-button class="colored" raised>D√©pot GitHub du Projet</paper-button></a></p>
<aside class="special"><p><strong>Remarque</strong> : Dans une application de production, vous souhaiterez peut-√™tre permettre aux utilisateurs de supprimer toutes les donn√©es sans r√©initialiser les donn√©es au red√©marrage de l&#39;application. Mais √† des fins de test, il est utile de pouvoir supprimer toutes les donn√©es, puis de les r√©initialiser au d√©marrage de l&#39;application.</p>
</aside>
<h2 is-upgraded>1.1 Ajouter une m√©thode au DAO pour obtenir un seul mot</h2>
<p>Actuellement, l&#39;interface <strong><code>WordDao</code></strong> poss√®de une m√©thode pour obtenir tous les mots, mais pas pour obtenir un mot sp√©cifique. La m√©thode pour obtenir un mot sp√©cifique n&#39;a pas besoin de renvoyer <code>LiveData</code>, car votre application appellera la m√©thode explicitement lorsque cela est n√©cessaire.</p>
<p>Dans l&#39;interface <strong><code>WordDao</code></strong>, ajoutez une m√©thode pour obtenir n&#39;importe quel mot.</p>
<pre><code>@Query(&#34;SELECT * from word_table LIMIT 1&#34;)
Word[] getAnyWord();</code></pre>
<p><code>Room</code> d√©clenche la requ√™te de base de donn√©es lorsque la m√©thode <code>getAnyWord()</code> est appel√©e et renvoie un tableau contenant un mot. Vous n&#39;avez pas besoin d&#39;√©crire de code suppl√©mentaire pour l&#39;impl√©menter.</p>
<h2 is-upgraded>1.2 Mettre √† jour la m√©thode d&#39;initialisation pour v√©rifier si des donn√©es existent</h2>
<p>Utilisez la m√©thode <strong><code>getAnyWord()</code></strong> dans la m√©thode qui initialise la base de donn√©es. S&#39;il y a des donn√©es, laissez-les telles quelles. S&#39;il n&#39;y a pas de donn√©es, ajoutez l&#39;ensemble de donn√©es initial.</p>
<ol type="1" start="1">
<li>Dans <strong><code>WordRoomDatbase</code></strong>, mettez √† jour le <strong><code>sRoomDatabaseCallback</code></strong> pour v√©rifier si la base de donn√©es contient des mots avant d&#39;initialiser les donn√©es.</li>
</ol>
<pre><code>databaseWriteExecutor.execute(() -&gt; {
     // Remplir la base de donn√©es en arri√®re-plan
     // Si vous voulez commencer avec plus de mots, il suffit de les ajouter.
     WordDao dao = INSTANCE.wordDao();
     // Si nous n&#39;avons pas de mots, alors cr√©ons la liste initiale de mots.
     if (dao.getAnyWord().length &lt; 1) {
          Word word = new Word(&#34;Hello&#34;);
          dao.insert(word);
          word = new Word(&#34;World&#34;);
          dao.insert(word);
     }
});</code></pre>
<ol type="1" start="2">
<li>Ex√©cutez votre application et ajoutez plusieurs nouveaux mots. Fermez l&#39;application et red√©marrez-la. Vous devriez voir les nouveaux mots que vous avez ajout√©s, car les mots doivent maintenant persister lorsque l&#39;application est ferm√©e et rouverte.</li>
</ol>


      </google-codelab-step>
    
      <google-codelab-step label="Effacer tous les mots" duration="0">
        <p>Dans le pr√©c√©dent exercice pratique, vous avez utilis√© la m√©thode <code>deleteAll()</code> pour effacer toutes les donn√©es √† l&#39;ouverture de la base de donn√©es. La m√©thode <code>deleteAll()</code> n&#39;√©tait appel√©e que depuis la fonction d&#39;appel <code>sRoomDatabaseCallback</code> au d√©marrage de l&#39;application. Vous allez maintenant rendre la m√©thode <code>deleteAll()</code> disponible via le <code>ViewModel</code> afin que votre application puisse appeler la m√©thode √† tout moment.</p>
<p>Voici les √©tapes g√©n√©rales pour impl√©menter une m√©thode d&#39;utilisation de la biblioth√®que Room pour interagir avec la base de donn√©es :</p>
<ul>
<li>Ajoutez la m√©thode au DAO et annotez-la avec l&#39;op√©ration de base de donn√©es correspondante. Pour la m√©thode <code>deleteAll()</code>, vous avez d√©j√† effectu√© cette √©tape dans le pr√©c√©dent TP.</li>
<li>Ajoutez la m√©thode √† la classe <code>WordRepository</code>. √âcrivez le code pour ex√©cuter la m√©thode en arri√®re-plan.</li>
<li>Pour appeler la m√©thode dans la classe <code>WordRepository</code>, ajoutez la m√©thode au <code>WordViewModel</code>. Le reste de l&#39;application pourra alors acc√©der √† la m√©thode par l&#39;interm√©diaire du <code>WordViewModel</code>.</li>
</ul>
<h2 is-upgraded>2.1 Ajoutez <code>deleteAll()</code> √† l&#39;interface <code>WordDao</code> et annotez-la.</h2>
<p>Dans <strong><code>WordDao</code></strong>, v√©rifiez que la m√©thode <strong><code>deleteAll()</code></strong> est d√©finie et annot√©e avec le SQL qui s&#39;ex√©cute lorsque la m√©thode s&#39;ex√©cute.</p>
<pre><code>@Query(&#34;DELETE FROM word_table&#34;)
void deleteAll();</code></pre>
<h2 is-upgraded>2.2 Ajouter la m√©thode <code>deleteAll</code><code>()</code> √† la classe <code>WordRepository</code></h2>
<p>Add the <code>deleteAll()</code> method to the <code>WordRepository</code> and use ExecutorService to delete all words in the background.</p>
<pre><code>public void deleteAll(){
        WordRoomDatabase.databaseWriteExecutor.execute(() -&gt; mWordDao.deleteAll());
}</code></pre>
<h2 is-upgraded>2.3 Ajouter la m√©thode <code>deleteAll</code><code>()</code> √† la classe <code>WordViewModel</code></h2>
<p>Rendez la m√©thode <strong><code>deleteAll()</code></strong> disponible pour l&#39;activit√© principale en l&#39;ajoutant au <strong><code>WordViewModel</code></strong>.</p>
<p>Dans la classe WordViewModel, ajoutez la m√©thode deleteAll():</p>
<pre><code>public void deleteAll() {mRepository.deleteAll();}</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Ajouter un √©l√©ment de menu Options pour supprimer toutes les donn√©es" duration="0">
        <p>Ensuite, vous ajoutez une option au menu pour permettre aux utilisateurs de supprimer toutes les donn√©es.</p>
<aside class="special"><p><strong>Remarque</strong> : La version de production de votre application doit fournir des garanties pour √©viter que les utilisateurs n&#39;effacent accidentellement l&#39;int√©gralit√© de leur base de donn√©es. Cependant, pendant le d√©veloppement de votre application, il est utile de pouvoir effacer rapidement les donn√©es de test. Cela est particuli√®rement vrai maintenant que votre application n&#39;efface pas les donn√©es √† son ouverture.</p>
</aside>
<h2 is-upgraded>3.1 Ajouter l&#39;option de menu &#34;Clear all data&#34;</h2>
<ol type="1" start="1">
<li>Dans <strong><code>menu_main.xml</code></strong>, modifiez le titre &#34;<strong><code>Clear all data</code></strong>&#34; et l&#39;identifiant de l&#39;option de menu, comme suit :</li>
</ol>
<pre><code>&lt;item
   android:id=&#34;@+id/clear_data&#34;
   android:orderInCategory=&#34;100&#34;
   android:title=&#34;@string/clear_all_data&#34;
   app:showAsAction=&#34;never&#34; /&gt;</code></pre>
<ol type="1" start="2">
<li>Dans <strong><code>MainActivity</code></strong>, impl√©mentez la m√©thode <strong><code>onOptionsItemSelected()</code></strong> pour appeler la m√©thode <strong><code>deleteAll()</code></strong> sur l&#39;objet <code>WordViewModel</code>.</li>
</ol>
<pre><code>public boolean onOptionsItemSelected(MenuItem item) {
    // Handle action bar item clicks here. The action bar will
    // automatically handle clicks on the Home/Up button, so long
    // as you specify a parent activity in AndroidManifest.xml.
    int id = item.getItemId();

    //noinspection SimplifiableIfStatement
    if (id == R.id.clear_data) {
        // Ajouter un toast de confirmation
        Toast.makeText(this, &#34;Clearing the data...&#34;,
                Toast.LENGTH_SHORT).show();

        // Effacer les donn√©es existantes
        mWordViewModel.deleteAll();
        return true;
    }

    return super.onOptionsItemSelected(item);
}</code></pre>
<ol type="1" start="3">
<li>Ex√©cutez votre application. Dans le menu Options, s√©lectionnez &#34;<strong><code>Clear all data"</code></strong>. Tous les mots devraient dispara√Ætre.</li>
<li>Red√©marrez l&#39;application. (Red√©marrez-la depuis votre appareil ou l&#39;√©mulateur ; ne la relancez pas depuis Android Studio). Vous devriez voir l&#39;ensemble initial de mots.</li>
</ol>


      </google-codelab-step>
    
      <google-codelab-step label="Supprimer un seul mot" duration="0">
        <p>Votre application permet aux utilisateurs d&#39;ajouter des mots et de supprimer tous les mots. Dans les t√¢ches 4 et 5, vous √©tendrez l&#39;application afin que les utilisateurs puissent supprimer un mot en faisant glisser l&#39;√©l√©ment dans le <code>RecyclerView</code>.</p>
<p>Encore une fois, voici les √©tapes g√©n√©rales pour impl√©menter une m√©thode d&#39;utilisation de la biblioth√®que Room pour interagir avec la base de donn√©es :</p>
<ul>
<li>Ajoutez la m√©thode au DAO et annotez-la avec l&#39;op√©ration de base de donn√©es correspondante.</li>
<li>Ajoutez la m√©thode √† la classe <code>WordRepository</code>. √âcrivez le code pour ex√©cuter la m√©thode en arri√®re-plan.</li>
<li>Pour appeler la m√©thode dans la classe <code>WordRepository</code>, ajoutez la m√©thode √† <code>WordViewModel</code>. Le reste de l&#39;application peut alors acc√©der √† la m√©thode via <code>WordViewModel</code>.</li>
</ul>
<h2 is-upgraded>4.1 Ajouter <code>deleteWord</code><code>()</code> √† la DAO et l&#39;annoter.</h2>
<p>Dans <strong><code>WordDao</code></strong>, ajoutez la m√©thode <strong><code>deleteWord()</code></strong>.</p>
<pre><code>@Delete
void deleteWord(Word word);</code></pre>
<p>Comme cette op√©ration supprime une seule ligne, l&#39;annotation <code>@Delete</code> est tout ce qui est n√©cessaire pour supprimer le mot de la base de donn√©es.</p>
<h2 is-upgraded>4.2 Ajouter <code>deleteWord</code><code>()</code> √† la classe <code>WordRepository</code></h2>
<ol type="1" start="1">
<li>Dans <strong><code>WordRepository</code></strong>, ajoutez la m√©thode <strong><code>deleteWord()</code></strong> pour supprimer un mot en appelant <strong><code>deleteWord()</code></strong> √† partir du DAO en utilisant <code>ExecutorService</code>.</li>
</ol>
<pre><code>public void deleteWord(Word word)  {
        WordRoomDatabase.databaseWriteExecutor.execute(() -&gt; mWordDao.deleteWord(word));
}</code></pre>
<h2 is-upgraded>4.3 Ajouter <code>deleteWord</code><code>()</code> √† la classe <code>WordViewModel</code></h2>
<p>Pour rendre la m√©thode <strong><code>deleteWord()</code></strong> disponible aux autres classes de l&#39;application, en particulier <code>MainActivity</code>, ajoutez-la √† <strong><code>WordViewModel</code></strong>.</p>
<pre><code>public void deleteWord(Word word) {mRepository.deleteWord(word);}</code></pre>
<p>Vous avez maintenant impl√©ment√© la logique pour supprimer un mot. Cependant, il n&#39;existe pas encore de moyen d&#39;appeler l&#39;op√©ration de suppression de mots depuis l&#39;interface utilisateur de l&#39;application. Vous allez r√©soudre ce probl√®me ensuite.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Permettre aux utilisateurs de balayer les mots pour les supprimer" duration="0">
        <p>Dans cette t√¢che, vous ajoutez une fonctionnalit√© pour permettre aux utilisateurs de balayer un √©l√©ment de la <code>RecyclerView</code> pour le supprimer.</p>
<p>Utilisez la classe <a href="https://developer.android.com/reference/androidx/recyclerview/widget/ItemTouchHelper" target="_blank"><code>ItemTouchHelper</code></a> fournie par la biblioth√®que de support Android (Androidx) pour impl√©menter la fonctionnalit√© de glissement dans votre <code>RecyclerView</code>. La classe <code>ItemTouchHelper</code> poss√®de les m√©thodes suivantes :</p>
<ul>
<li><code>onMove()</code> est appel√©e lorsque l&#39;utilisateur d√©place l&#39;√©l√©ment. Vous n&#39;impl√©menterez aucune fonctionnalit√© de d√©placement dans cette application.</li>
<li><code>onSwipe()</code> est appel√©e lorsque l&#39;utilisateur glisse l&#39;√©l√©ment. Vous impl√©mentez cette m√©thode pour supprimer le mot qui a √©t√© gliss√©.</li>
</ul>
<p class="image-container"><img style="width: 221.59px" src="img/6639edd4da022795.png"></p>
<h2 is-upgraded>5.1 Activer l&#39;adaptateur pour d√©tecter le mot gliss√©</h2>
<ol type="1" start="1">
<li>Dans <strong><code>WordListAdapter</code></strong>, ajouter une m√©thode pour obtenir le mot √† une position donn√©e.</li>
</ol>
<pre><code>public Word getWordAtPosition (int position) {
   return mWords.get(position);
}</code></pre>
<ol type="1" start="2">
<li>Dans <strong><code>MainActivity</code></strong>, dans <strong><code>onCreate()</code></strong>, cr√©ez le <strong><code>ItemTouchHelper</code></strong>. Attachez le <code>ItemTouchHelper</code> au <code>RecyclerView</code>.</li>
</ol>
<pre><code>// Ajouter la fonctionnalit√© de glisser pour supprimer les √©l√©ments de la recyclerview.
ItemTouchHelper helper = new ItemTouchHelper(
        new ItemTouchHelper.SimpleCallback(0,
                ItemTouchHelper.LEFT | ItemTouchHelper.RIGHT) {
            @Override
            public boolean onMove(@NonNull RecyclerView recyclerView,
                                  @NonNull RecyclerView.ViewHolder viewHolder,
                                  @NonNull RecyclerView.ViewHolder target) {
                return false;
            }

            @Override
            public void onSwiped(@NonNull RecyclerView.ViewHolder viewHolder,
                                 int direction) {
                int position = viewHolder.getAdapterPosition();
                Word swipedWord = mAdapter.getWordAtPosition(position);
                Toast.makeText(MainActivity.this, &#34;Deleting &#34; +
                        swipedWord.getWord(), Toast.LENGTH_LONG).show();

                // Supprimer le mot
                mWordViewModel.deleteWord(swipedWord);
            }
        });

helper.attachToRecyclerView(binding.contentMain.recyclerview);</code></pre>
<p>Points √† noter dans le code:</p>
<ul>
<li><strong><code>viewHolder.getAdapterPosition()</code></strong>: <code>onSwiped()</code> r√©cup√®re la position du <code>ViewHolder</code> qui a √©t√© gliss√©.</li>
<li><strong><code>mAdapter.getWordAtPosition(position)</code></strong>: En fonction de la position, vous pouvez obtenir le mot affich√© par le <code>ViewHolder</code> en appelant la m√©thode <code>getWordAtPosition()</code> que vous avez d√©finie dans l&#39;adaptateur.</li>
<li><strong><code>mWordViewModel.deleteWord(swipedWord)</code></strong>: Supprime le mot en appelant <code>deleteWord()</code> sur le <code>WordViewModel</code>.</li>
</ul>
<ol type="1" start="3">
<li>Lancez votre application. Vous devriez pouvoir supprimer des mots en les faisant glisser vers la gauche ou vers la droite.</li>
</ol>
<h2 is-upgraded>Code de solution</h2>
<p><a href="https://github.com/khammami/android-fundamentals-exycodelabs/archive/refs/heads/room-words-with-delete-2023.zip" target="_blank"><paper-button class="colored" raised>T√©l√©charger .zip</paper-button></a> <a href="https://github.com/khammami/android-fundamentals-exycodelabs/tree/room-words-with-delete-2023" target="_blank"><paper-button class="colored" raised>D√©pot GitHub du Projet</paper-button></a> <a href="https://github.com/khammami/android-fundamentals-exycodelabs/compare/room-words-sample-2023...khammami:android-fundamentals-exycodelabs:room-words-with-delete-2023" target="_blank"><paper-button class="colored" raised>Voir la diff√©rence</paper-button></a></p>


      </google-codelab-step>
    
      <google-codelab-step label="D√©fi de codage" duration="0">
        <aside class="special"><p><strong>Remarque</strong> : Tous les d√©fis de codage sont facultatifs et ne sont pas des pr√©requis pour les le√ßons ult√©rieures.</p>
</aside>
<p>D√©fi : Mettez √† jour votre application pour permettre aux utilisateurs de modifier un mot en appuyant sur le mot, puis en sauvegardant leurs modifications.</p>
<h2 is-upgraded>Indices</h2>
<h3 is-upgraded>Faire des changements dans <code>NewWordActivity</code></h3>
<p>Vous pouvez ajouter des fonctionnalit√©s √† <code>NewWordActivity</code>, afin qu&#39;elle puisse √™tre utilis√©e soit pour ajouter un nouveau mot, soit pour modifier un mot existant.</p>
<h3 is-upgraded>Utiliser une cl√© auto-g√©n√©r√©e dans <code>Word</code></h3>
<p>La classe d&#39;entit√© <code>Word</code> utilise le champ word comme cl√© de base de donn√©es. Cependant, lorsque vous mettez √† jour une ligne dans la base de donn√©es, l&#39;√©l√©ment mis √† jour ne peut pas √™tre la cl√© primaire, car la cl√© primaire est unique √† chaque ligne et ne change jamais. Vous devez donc ajouter un identifiant <code>id</code> g√©n√©r√© automatiquement √† utiliser comme cl√© primaire.</p>
<pre><code>@PrimaryKey(autoGenerate = true)
private int id;

@NonNull
@ColumnInfo(name = &#34;word&#34;)
private String mWord;</code></pre>
<h3 is-upgraded>Ajouter un constructeur pour <code>Word</code> qui prend un <code>id</code></h3>
<p>Ajoutez un constructeur √† la classe d&#39;entit√© <code>Word</code> qui prend id et word comme param√®tres. Assurez-vous que ce constructeur suppl√©mentaire est annot√© √† l&#39;aide de <code>@Ignore</code>, car Room attend par d√©faut un seul constructeur dans une classe d&#39;entit√©.</p>
<pre><code>@Ignore
public Word(int id, @NonNull String word) {
   this.id = id;
   this.mWord = word;
}</code></pre>
<p>Pour mettre √† jour un mot existant, cr√©ez le mot en utilisant ce constructeur. Room utilisera la cl√© primaire (dans ce cas, l&#39;<code>id</code>) pour trouver l&#39;entr√©e existante dans la base de donn√©es afin qu&#39;elle puisse √™tre mise √† jour.</p>
<p>Dans <code>WordDao</code>, ajoutez la m√©thode <code>update()</code> comme ceci :</p>
<pre><code>@Update
void update(Word... word);</code></pre>
<p>Dans <code>WordRoomDatabase</code>, augmentez le num√©ro de version de la base de donn√©es, car la structure de la table de la base de donn√©es a √©t√© modifi√©e.</p>
<pre><code>@Database(entities = {Word.class}, version = 2, exportSchema = false)</code></pre>
<h2 is-upgraded>Code de solution de d√©fi üëÄ</h2>
<p><a href="https://github.com/khammami/android-fundamentals-exycodelabs/archive/refs/heads/room-words-with-update-2023.zip" target="_blank"><paper-button class="colored" raised>T√©l√©charger .zip</paper-button></a> <a href="https://github.com/khammami/android-fundamentals-exycodelabs/tree/room-words-with-update-2023" target="_blank"><paper-button class="colored" raised>D√©pot GitHub du Projet</paper-button></a> <a href="https://github.com/khammami/android-fundamentals-exycodelabs/compare/room-words-with-delete-2023...khammami:android-fundamentals-exycodelabs:room-words-with-update-2023" target="_blank"><paper-button class="colored" raised>Voir la diff√©rence</paper-button></a></p>


      </google-codelab-step>
    
      <google-codelab-step label="R√©sum√©" duration="0">
        <h2 is-upgraded>√âcrire du code de base de donn√©es</h2>
<ul>
<li><code>Room</code> se charge d&#39;ouvrir et de fermer les connexions √† la base de donn√©es chaque fois qu&#39;une op√©ration de base de donn√©es est ex√©cut√©e.</li>
<li>Annotez les m√©thodes de l&#39;objet d&#39;acc√®s aux donn√©es (DAO) avec <code>@insert</code>, <code>@delete</code>, <code>@update</code>, <code>@query</code>.</li>
<li>Pour les insertions, mises √† jour et suppressions simples, il suffit d&#39;ajouter l&#39;annotation correspondante √† la m√©thode dans le DAO.</li>
</ul>
<p>Par exemple:</p>
<pre><code>@Delete
void deleteWord(Word word);

@Update
void update(Word... word);</code></pre>
<ul>
<li>Pour les requ√™tes ou les interactions plus complexes avec la base de donn√©es, telles que la suppression de tous les mots, utilisez l&#39;annotation <code>@query</code> et fournissez le SQL de l&#39;op√©ration.</li>
</ul>
<p>Par exemple:</p>
<pre><code>@Query(&#34;SELECT * from word_table ORDER BY word ASC&#34;)
LiveData&lt;List&lt;Word&gt;&gt; getAllWords();

@Query(&#34;DELETE FROM word_table&#34;)
void deleteAll();</code></pre>
<h2 is-upgraded><code>ItemTouchHelper</code></h2>
<ul>
<li>Pour permettre aux utilisateurs de glisser ou de d√©placer des √©l√©ments dans un <code>RecyclerView</code>, vous pouvez utiliser la classe <code>ItemTouchHelper</code>.</li>
<li>Impl√©mentez les m√©thodes <code>onMove()</code> et <code>onSwipe()</code>.</li>
<li>Pour identifier l&#39;√©l√©ment que l&#39;utilisateur a d√©plac√© ou balay√©, vous pouvez ajouter une m√©thode √† l&#39;adaptateur du <code>RecyclerView</code>. La m√©thode prend une position en entr√©e et renvoie l&#39;√©l√©ment correspondant. Appelez la m√©thode dans <code>onMove()</code> ou <code>onSwipe()</code>.</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Apprendre encore plus" duration="0">
        <p>Entities, data access objects (DAOs), et <code>ViewModel</code>:</p>
<ul>
<li><a href="https://developer.android.com/training/data-storage/room/defining-data.html" target="_blank">Defining data using Room entities</a></li>
<li><a href="https://developer.android.com/training/data-storage/room/accessing-data.html" target="_blank">Accessing data using Room DAOs</a></li>
<li><a href="https://developer.android.com/topic/libraries/architecture/viewmodel.html" target="_blank"><code>ViewModel</code> guide</a></li>
<li><a href="https://developer.android.com/reference/android/arch/persistence/room/Dao.html" target="_blank"><code>Dao</code> r√©f√©rence</a></li>
<li><a href="https://developer.android.com/reference/android/arch/lifecycle/ViewModel.html" target="_blank"><code>ViewModel</code> r√©f√©rence</a></li>
<li>Pour voir toutes les annotations possibles pour une entit√©, rendez-vous sur <a href="https://developer.android.com/reference/androidx/room/package-summary" target="_blank">androidx.room</a> dans la documentation Android et d√©veloppez l&#39;√©l√©ment de menu Annotations dans le panneau de navigation de gauche.<br></li>
</ul>
<p><code>ItemTouchHelper</code>:</p>
<ul>
<li><a href="https://developer.android.com/reference/androidx/recyclerview/widget/ItemTouchHelper" target="_blank"><code>ItemTouchHelper</code></a> reference</li>
</ul>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/claat-public/native-shim.js"></script>
  <script src="https://storage.googleapis.com/claat-public/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/claat-public/prettify.js"></script>
  <script src="https://storage.googleapis.com/claat-public/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
